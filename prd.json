{
  "project": {
    "name": "Alert Quebec",
    "description": "Unified snow removal and waste collection alert system for Montreal and Quebec City",
    "version": "2.0.0",
    "tech_stack": {
      "backend": "Python Flask",
      "database": "PostgreSQL",
      "scheduler": "APScheduler",
      "soap_client": "zeep (Montreal)",
      "rest_client": "requests (Quebec)",
      "email": "Resend",
      "hosting": "Render.com"
    }
  },
  "phases": [
    {
      "id": "phase-1",
      "name": "Project Restructure & City Toggle UI",
      "tasks": [
        {
          "id": "task-1.1",
          "name": "Rename project and update branding",
          "microtasks": [
            {
              "id": "mt-1.1.1",
              "name": "Rename project directory to alert-quebec",
              "tests": [{ "type": "unit", "description": "Verify project imports work", "file": "tests/test_imports.py" }]
            },
            {
              "id": "mt-1.1.2",
              "name": "Update all references from alert-mtl to alert-quebec",
              "tests": [{ "type": "unit", "description": "Grep for old name returns zero", "file": "tests/test_naming.py" }]
            },
            {
              "id": "mt-1.1.3",
              "name": "Update page title and meta tags",
              "tests": [{ "type": "e2e", "description": "Verify page title is Alert Quebec", "file": "tests/test_ui.py::test_page_title" }]
            }
          ]
        },
        {
          "id": "task-1.2",
          "name": "Create city toggle component",
          "microtasks": [
            {
              "id": "mt-1.2.1",
              "name": "Add city icons section with Montreal (üèôÔ∏è) and Quebec (üè∞) emojis",
              "tests": [{ "type": "e2e", "description": "Verify both icons are visible", "file": "tests/test_ui.py::test_city_icons" }]
            },
            {
              "id": "mt-1.2.2",
              "name": "Create iOS-style toggle switch below icons",
              "tests": [{ "type": "e2e", "description": "Verify toggle is interactive", "file": "tests/test_ui.py::test_toggle_switch" }]
            },
            {
              "id": "mt-1.2.3",
              "name": "Add city name labels under each icon",
              "tests": [{ "type": "e2e", "description": "Verify labels are Montreal and Quebec City", "file": "tests/test_ui.py::test_city_labels" }]
            },
            {
              "id": "mt-1.2.4",
              "name": "Set Montreal as default (left position)",
              "tests": [{ "type": "e2e", "description": "Verify Montreal is selected on load", "file": "tests/test_ui.py::test_default_city" }]
            },
            {
              "id": "mt-1.2.5",
              "name": "Add smooth 0.3s ease animation on toggle",
              "tests": [{ "type": "e2e", "description": "Verify animation duration", "file": "tests/test_ui.py::test_toggle_animation" }]
            },
            {
              "id": "mt-1.2.6",
              "name": "Enlarge selected city icon (1.1x scale) and dim unselected (0.5 opacity)",
              "tests": [{ "type": "e2e", "description": "Verify icon styling changes", "file": "tests/test_ui.py::test_icon_selection_style" }]
            },
            {
              "id": "mt-1.2.7",
              "name": "Persist city selection in localStorage",
              "tests": [{ "type": "e2e", "description": "Verify localStorage saves and restores city", "file": "tests/test_ui.py::test_city_persistence" }]
            }
          ]
        },
        {
          "id": "task-1.3",
          "name": "Implement city-specific theming",
          "microtasks": [
            {
              "id": "mt-1.3.1",
              "name": "Define Montreal color scheme (blue primary #0071e3)",
              "tests": [{ "type": "e2e", "description": "Verify Montreal uses blue theme", "file": "tests/test_ui.py::test_montreal_theme" }]
            },
            {
              "id": "mt-1.3.2",
              "name": "Define Quebec color scheme (purple primary #5856d6)",
              "tests": [{ "type": "e2e", "description": "Verify Quebec uses purple theme", "file": "tests/test_ui.py::test_quebec_theme" }]
            },
            {
              "id": "mt-1.3.3",
              "name": "Apply theme colors to toggle track, buttons, and accents",
              "tests": [{ "type": "e2e", "description": "Verify color changes on toggle", "file": "tests/test_ui.py::test_theme_application" }]
            },
            {
              "id": "mt-1.3.4",
              "name": "Update placeholder text based on city (H2V vs G1R postal codes)",
              "tests": [{ "type": "e2e", "description": "Verify placeholder changes", "file": "tests/test_ui.py::test_placeholder_city" }]
            }
          ]
        }
      ]
    },
    {
      "id": "phase-2",
      "name": "Unified Data Models",
      "tasks": [
        {
          "id": "task-2.1",
          "name": "Update Subscriber model with city field",
          "microtasks": [
            {
              "id": "mt-2.1.1",
              "name": "Add city column to Subscriber model (montreal/quebec)",
              "tests": [{ "type": "unit", "description": "Test city field exists", "file": "tests/test_models.py::test_subscriber_city_field" }]
            },
            {
              "id": "mt-2.1.2",
              "name": "Add city auto-detection from postal code prefix",
              "tests": [{ "type": "unit", "description": "Test H‚Üímontreal, G‚Üíquebec", "file": "tests/test_models.py::test_city_detection" }]
            },
            {
              "id": "mt-2.1.3",
              "name": "Add cote_rue_id field for Montreal subscribers",
              "tests": [{ "type": "unit", "description": "Test Montreal-specific field", "file": "tests/test_models.py::test_montreal_fields" }]
            },
            {
              "id": "mt-2.1.4",
              "name": "Add waste_zone_id field for Quebec subscribers",
              "tests": [{ "type": "unit", "description": "Test Quebec-specific field", "file": "tests/test_models.py::test_quebec_fields" }]
            }
          ]
        },
        {
          "id": "task-2.2",
          "name": "Update AlertHistory model",
          "microtasks": [
            {
              "id": "mt-2.2.1",
              "name": "Add city column to AlertHistory",
              "tests": [{ "type": "unit", "description": "Test city field in history", "file": "tests/test_models.py::test_history_city" }]
            },
            {
              "id": "mt-2.2.2",
              "name": "Add index on (subscriber_id, city, alert_type, reference_date)",
              "tests": [{ "type": "unit", "description": "Test unique constraint", "file": "tests/test_models.py::test_history_index" }]
            }
          ]
        },
        {
          "id": "task-2.3",
          "name": "Add Quebec WasteZone model",
          "microtasks": [
            {
              "id": "mt-2.3.1",
              "name": "Create WasteZone model with zone_code, garbage_day, recycling_week",
              "tests": [{ "type": "unit", "description": "Test WasteZone creation", "file": "tests/test_models.py::test_waste_zone_model" }]
            },
            {
              "id": "mt-2.3.2",
              "name": "Add relationship between Subscriber and WasteZone",
              "tests": [{ "type": "unit", "description": "Test subscriber waste zone link", "file": "tests/test_models.py::test_subscriber_waste_zone" }]
            }
          ]
        },
        {
          "id": "task-2.4",
          "name": "Create database migration",
          "microtasks": [
            {
              "id": "mt-2.4.1",
              "name": "Generate migration for new columns",
              "tests": [{ "type": "integration", "description": "Test migration applies", "file": "tests/test_migrations.py::test_v2_migration" }]
            },
            {
              "id": "mt-2.4.2",
              "name": "Set default city='montreal' for existing subscribers",
              "tests": [{ "type": "integration", "description": "Test data migration", "file": "tests/test_migrations.py::test_default_city" }]
            }
          ]
        }
      ]
    },
    {
      "id": "phase-3",
      "name": "Reorganize Services by City",
      "tasks": [
        {
          "id": "task-3.1",
          "name": "Create city-specific service folders",
          "microtasks": [
            {
              "id": "mt-3.1.1",
              "name": "Create app/services/montreal/ directory",
              "tests": [{ "type": "unit", "description": "Verify directory exists", "file": "tests/test_structure.py" }]
            },
            {
              "id": "mt-3.1.2",
              "name": "Create app/services/quebec/ directory",
              "tests": [{ "type": "unit", "description": "Verify directory exists", "file": "tests/test_structure.py" }]
            },
            {
              "id": "mt-3.1.3",
              "name": "Move planif_neige.py to services/montreal/",
              "tests": [{ "type": "unit", "description": "Test import from new path", "file": "tests/test_imports.py::test_montreal_services" }]
            },
            {
              "id": "mt-3.1.4",
              "name": "Move geobase.py to services/montreal/",
              "tests": [{ "type": "unit", "description": "Test import from new path", "file": "tests/test_imports.py::test_montreal_geobase" }]
            },
            {
              "id": "mt-3.1.5",
              "name": "Move waste.py to services/montreal/",
              "tests": [{ "type": "unit", "description": "Test import from new path", "file": "tests/test_imports.py::test_montreal_waste" }]
            }
          ]
        },
        {
          "id": "task-3.2",
          "name": "Port Quebec City snow checker",
          "microtasks": [
            {
              "id": "mt-3.2.1",
              "name": "Copy snow_checker.py from snow-alert to services/quebec/",
              "tests": [{ "type": "unit", "description": "Test Quebec snow checker import", "file": "tests/test_imports.py::test_quebec_snow" }]
            },
            {
              "id": "mt-3.2.2",
              "name": "Adapt geocode_postal_code for G postal codes",
              "tests": [{ "type": "unit", "description": "Test G postal code geocoding", "file": "tests/test_quebec_snow.py::test_geocode_quebec" }]
            },
            {
              "id": "mt-3.2.3",
              "name": "Adapt check_snow_removal for Quebec ArcGIS API",
              "tests": [{ "type": "unit", "description": "Test Quebec snow status", "file": "tests/test_quebec_snow.py::test_check_snow" }]
            },
            {
              "id": "mt-3.2.4",
              "name": "Add Quebec FSA coordinate lookup table",
              "tests": [{ "type": "unit", "description": "Test G FSA fallback", "file": "tests/test_quebec_snow.py::test_fsa_fallback" }]
            }
          ]
        },
        {
          "id": "task-3.3",
          "name": "Port Quebec City waste service",
          "microtasks": [
            {
              "id": "mt-3.3.1",
              "name": "Copy waste_service.py from snow-alert to services/quebec/",
              "tests": [{ "type": "unit", "description": "Test Quebec waste import", "file": "tests/test_imports.py::test_quebec_waste" }]
            },
            {
              "id": "mt-3.3.2",
              "name": "Adapt zone lookup for Quebec structure",
              "tests": [{ "type": "unit", "description": "Test zone lookup", "file": "tests/test_quebec_waste.py::test_zone_lookup" }]
            },
            {
              "id": "mt-3.3.3",
              "name": "Implement garbage_day and recycling_week logic",
              "tests": [{ "type": "unit", "description": "Test schedule calculation", "file": "tests/test_quebec_waste.py::test_schedule" }]
            }
          ]
        },
        {
          "id": "task-3.4",
          "name": "Create unified service dispatcher",
          "microtasks": [
            {
              "id": "mt-3.4.1",
              "name": "Create get_snow_status(city, postal_code) function",
              "tests": [{ "type": "unit", "description": "Test dispatcher routing", "file": "tests/test_dispatcher.py::test_snow_dispatch" }]
            },
            {
              "id": "mt-3.4.2",
              "name": "Create get_waste_schedule(city, lat, lon) function",
              "tests": [{ "type": "unit", "description": "Test waste dispatch", "file": "tests/test_dispatcher.py::test_waste_dispatch" }]
            },
            {
              "id": "mt-3.4.3",
              "name": "Create geocode_postal_code(postal_code) with auto city detection",
              "tests": [{ "type": "unit", "description": "Test geocode dispatch", "file": "tests/test_dispatcher.py::test_geocode_dispatch" }]
            }
          ]
        }
      ]
    },
    {
      "id": "phase-4",
      "name": "Unified API Routes",
      "tasks": [
        {
          "id": "task-4.1",
          "name": "Update quick-check endpoint",
          "microtasks": [
            {
              "id": "mt-4.1.1",
              "name": "Auto-detect city from postal code in /api/quick-check/{postal}",
              "tests": [{ "type": "integration", "description": "Test city detection", "file": "tests/test_routes.py::test_quick_check_city_detect" }]
            },
            {
              "id": "mt-4.1.2",
              "name": "Route to Montreal service for H postal codes",
              "tests": [{ "type": "integration", "description": "Test Montreal routing", "file": "tests/test_routes.py::test_quick_check_montreal" }]
            },
            {
              "id": "mt-4.1.3",
              "name": "Route to Quebec service for G postal codes",
              "tests": [{ "type": "integration", "description": "Test Quebec routing", "file": "tests/test_routes.py::test_quick_check_quebec" }]
            },
            {
              "id": "mt-4.1.4",
              "name": "Return unified response format with city field",
              "tests": [{ "type": "integration", "description": "Test response format", "file": "tests/test_routes.py::test_response_format" }]
            }
          ]
        },
        {
          "id": "task-4.2",
          "name": "Update subscribe endpoint",
          "microtasks": [
            {
              "id": "mt-4.2.1",
              "name": "Auto-detect and store city from postal code",
              "tests": [{ "type": "integration", "description": "Test city stored", "file": "tests/test_routes.py::test_subscribe_city" }]
            },
            {
              "id": "mt-4.2.2",
              "name": "Store city-specific fields (cote_rue_id for MTL, waste_zone_id for QC)",
              "tests": [{ "type": "integration", "description": "Test city-specific data", "file": "tests/test_routes.py::test_subscribe_city_fields" }]
            },
            {
              "id": "mt-4.2.3",
              "name": "Reject unsupported postal codes (not H or G)",
              "tests": [{ "type": "integration", "description": "Test unsupported postal", "file": "tests/test_routes.py::test_unsupported_postal" }]
            }
          ]
        },
        {
          "id": "task-4.3",
          "name": "Add city-specific internal endpoints",
          "microtasks": [
            {
              "id": "mt-4.3.1",
              "name": "Create /api/montreal/snow-status/{postal}",
              "tests": [{ "type": "integration", "description": "Test Montreal-only endpoint", "file": "tests/test_routes.py::test_montreal_snow" }]
            },
            {
              "id": "mt-4.3.2",
              "name": "Create /api/quebec/snow-status/{postal}",
              "tests": [{ "type": "integration", "description": "Test Quebec-only endpoint", "file": "tests/test_routes.py::test_quebec_snow" }]
            },
            {
              "id": "mt-4.3.3",
              "name": "Create /api/montreal/waste-schedule",
              "tests": [{ "type": "integration", "description": "Test Montreal waste", "file": "tests/test_routes.py::test_montreal_waste" }]
            },
            {
              "id": "mt-4.3.4",
              "name": "Create /api/quebec/waste-schedule",
              "tests": [{ "type": "integration", "description": "Test Quebec waste", "file": "tests/test_routes.py::test_quebec_waste" }]
            }
          ]
        }
      ]
    },
    {
      "id": "phase-5",
      "name": "Unified Scheduler Jobs",
      "tasks": [
        {
          "id": "task-5.1",
          "name": "Add city-specific snow check jobs",
          "microtasks": [
            {
              "id": "mt-5.1.1",
              "name": "Create snow_check_montreal job (every 10 min)",
              "tests": [{ "type": "unit", "description": "Test Montreal job runs", "file": "tests/test_scheduler.py::test_montreal_snow_job" }]
            },
            {
              "id": "mt-5.1.2",
              "name": "Create snow_check_quebec job (every 10 min)",
              "tests": [{ "type": "unit", "description": "Test Quebec job runs", "file": "tests/test_scheduler.py::test_quebec_snow_job" }]
            },
            {
              "id": "mt-5.1.3",
              "name": "Filter subscribers by city when checking",
              "tests": [{ "type": "unit", "description": "Test city filtering", "file": "tests/test_scheduler.py::test_subscriber_filtering" }]
            }
          ]
        },
        {
          "id": "task-5.2",
          "name": "Add city-specific waste reminder jobs",
          "microtasks": [
            {
              "id": "mt-5.2.1",
              "name": "Create waste_reminder_montreal job (6 PM)",
              "tests": [{ "type": "unit", "description": "Test Montreal waste job", "file": "tests/test_scheduler.py::test_montreal_waste_job" }]
            },
            {
              "id": "mt-5.2.2",
              "name": "Create waste_reminder_quebec job (6 PM)",
              "tests": [{ "type": "unit", "description": "Test Quebec waste job", "file": "tests/test_scheduler.py::test_quebec_waste_job" }]
            }
          ]
        },
        {
          "id": "task-5.3",
          "name": "Update admin triggers",
          "microtasks": [
            {
              "id": "mt-5.3.1",
              "name": "Add city parameter to /admin/trigger-snow-check",
              "tests": [{ "type": "integration", "description": "Test city param", "file": "tests/test_routes.py::test_trigger_city" }]
            },
            {
              "id": "mt-5.3.2",
              "name": "Add city parameter to /admin/trigger-waste-check",
              "tests": [{ "type": "integration", "description": "Test city param", "file": "tests/test_routes.py::test_trigger_waste_city" }]
            }
          ]
        }
      ]
    },
    {
      "id": "phase-6",
      "name": "Email Templates with City Context",
      "tasks": [
        {
          "id": "task-6.1",
          "name": "Update email templates with city variables",
          "microtasks": [
            {
              "id": "mt-6.1.1",
              "name": "Add city_name variable (Montreal / Quebec City)",
              "tests": [{ "type": "unit", "description": "Test city name in email", "file": "tests/test_email.py::test_city_name" }]
            },
            {
              "id": "mt-6.1.2",
              "name": "Add city_icon variable (üèôÔ∏è / üè∞)",
              "tests": [{ "type": "unit", "description": "Test city icon in email", "file": "tests/test_email.py::test_city_icon" }]
            },
            {
              "id": "mt-6.1.3",
              "name": "Add city-specific details section (Montreal status vs Quebec lights)",
              "tests": [{ "type": "unit", "description": "Test city details", "file": "tests/test_email.py::test_city_details" }]
            }
          ]
        },
        {
          "id": "task-6.2",
          "name": "Update footer with city data source",
          "microtasks": [
            {
              "id": "mt-6.2.1",
              "name": "Show Ville de Montr√©al for Montreal emails",
              "tests": [{ "type": "unit", "description": "Test Montreal footer", "file": "tests/test_email.py::test_montreal_footer" }]
            },
            {
              "id": "mt-6.2.2",
              "name": "Show Ville de Qu√©bec for Quebec emails",
              "tests": [{ "type": "unit", "description": "Test Quebec footer", "file": "tests/test_email.py::test_quebec_footer" }]
            }
          ]
        }
      ]
    },
    {
      "id": "phase-7",
      "name": "Frontend City Toggle Integration",
      "tasks": [
        {
          "id": "task-7.1",
          "name": "Connect toggle to API calls",
          "microtasks": [
            {
              "id": "mt-7.1.1",
              "name": "Pass city context to quick-check API",
              "tests": [{ "type": "e2e", "description": "Test API receives city", "file": "tests/test_ui.py::test_api_city_context" }]
            },
            {
              "id": "mt-7.1.2",
              "name": "Validate postal code matches selected city",
              "tests": [{ "type": "e2e", "description": "Test postal validation", "file": "tests/test_ui.py::test_postal_city_match" }]
            },
            {
              "id": "mt-7.1.3",
              "name": "Show error if postal doesn't match city",
              "tests": [{ "type": "e2e", "description": "Test mismatch error", "file": "tests/test_ui.py::test_postal_mismatch_error" }]
            }
          ]
        },
        {
          "id": "task-7.2",
          "name": "Update results display for each city",
          "microtasks": [
            {
              "id": "mt-7.2.1",
              "name": "Display Montreal-style results (Planifi√©/En cours/D√©neig√©)",
              "tests": [{ "type": "e2e", "description": "Test Montreal results", "file": "tests/test_ui.py::test_montreal_results" }]
            },
            {
              "id": "mt-7.2.2",
              "name": "Display Quebec-style results (flashing lights, distance)",
              "tests": [{ "type": "e2e", "description": "Test Quebec results", "file": "tests/test_ui.py::test_quebec_results" }]
            },
            {
              "id": "mt-7.2.3",
              "name": "Show city-appropriate waste schedule format",
              "tests": [{ "type": "e2e", "description": "Test waste display", "file": "tests/test_ui.py::test_waste_by_city" }]
            }
          ]
        },
        {
          "id": "task-7.3",
          "name": "Update subscribe form for city context",
          "microtasks": [
            {
              "id": "mt-7.3.1",
              "name": "Include city in subscribe request",
              "tests": [{ "type": "e2e", "description": "Test subscribe includes city", "file": "tests/test_ui.py::test_subscribe_city" }]
            },
            {
              "id": "mt-7.3.2",
              "name": "Show city-specific confirmation message",
              "tests": [{ "type": "e2e", "description": "Test confirmation message", "file": "tests/test_ui.py::test_confirm_city" }]
            }
          ]
        }
      ]
    },
    {
      "id": "phase-8",
      "name": "GitHub Actions Update",
      "tasks": [
        {
          "id": "task-8.1",
          "name": "Update scheduled triggers for both cities",
          "microtasks": [
            {
              "id": "mt-8.1.1",
              "name": "Add Montreal snow trigger endpoint",
              "tests": [{ "type": "manual", "description": "Verify workflow triggers Montreal" }]
            },
            {
              "id": "mt-8.1.2",
              "name": "Add Quebec snow trigger endpoint",
              "tests": [{ "type": "manual", "description": "Verify workflow triggers Quebec" }]
            },
            {
              "id": "mt-8.1.3",
              "name": "Add both cities waste trigger",
              "tests": [{ "type": "manual", "description": "Verify waste triggers both" }]
            }
          ]
        }
      ]
    },
    {
      "id": "phase-9",
      "name": "Testing & Deployment",
      "tasks": [
        {
          "id": "task-9.1",
          "name": "Integration tests for both cities",
          "microtasks": [
            {
              "id": "mt-9.1.1",
              "name": "Test full Montreal flow (H postal ‚Üí subscribe ‚Üí alert)",
              "tests": [{ "type": "integration", "description": "Montreal E2E test", "file": "tests/test_integration.py::test_montreal_flow" }]
            },
            {
              "id": "mt-9.1.2",
              "name": "Test full Quebec flow (G postal ‚Üí subscribe ‚Üí alert)",
              "tests": [{ "type": "integration", "description": "Quebec E2E test", "file": "tests/test_integration.py::test_quebec_flow" }]
            },
            {
              "id": "mt-9.1.3",
              "name": "Test city toggle preserves state across actions",
              "tests": [{ "type": "e2e", "description": "Toggle state test", "file": "tests/test_integration.py::test_toggle_state" }]
            }
          ]
        },
        {
          "id": "task-9.2",
          "name": "Update deployment configuration",
          "microtasks": [
            {
              "id": "mt-9.2.1",
              "name": "Update render.yaml with alert-quebec name",
              "tests": [{ "type": "manual", "description": "Verify Render deployment" }]
            },
            {
              "id": "mt-9.2.2",
              "name": "Add ENABLE_MONTREAL and ENABLE_QUEBEC env vars",
              "tests": [{ "type": "manual", "description": "Verify feature flags" }]
            },
            {
              "id": "mt-9.2.3",
              "name": "Update APP_URL to alert-quebec.onrender.com",
              "tests": [{ "type": "manual", "description": "Verify URL update" }]
            }
          ]
        },
        {
          "id": "task-9.3",
          "name": "Run all tests and verify coverage",
          "microtasks": [
            {
              "id": "mt-9.3.1",
              "name": "Verify 90%+ test coverage",
              "tests": [{ "type": "coverage", "description": "Coverage report", "file": "pytest --cov" }]
            },
            {
              "id": "mt-9.3.2",
              "name": "Verify all new city-specific tests pass",
              "tests": [{ "type": "unit", "description": "All tests pass", "file": "pytest tests/" }]
            }
          ]
        }
      ]
    },
    {
      "id": "phase-10",
      "name": "Internationalization (i18n) - French Language Support",
      "tasks": [
        {
          "id": "task-10.1",
          "name": "Create language toggle UI component",
          "microtasks": [
            {
              "id": "mt-10.1.1",
              "name": "Add language toggle in top-right corner (EN/FR pill buttons)",
              "tests": [{ "type": "e2e", "description": "Verify language toggle is visible in header", "file": "tests/test_i18n.py::test_language_toggle_visible" }]
            },
            {
              "id": "mt-10.1.2",
              "name": "Style toggle with active/inactive states matching design system",
              "tests": [{ "type": "e2e", "description": "Verify active language has filled background", "file": "tests/test_i18n.py::test_toggle_active_style" }]
            },
            {
              "id": "mt-10.1.3",
              "name": "Add hover effects and smooth transitions (0.2s ease)",
              "tests": [{ "type": "e2e", "description": "Verify hover state changes", "file": "tests/test_i18n.py::test_toggle_hover" }]
            },
            {
              "id": "mt-10.1.4",
              "name": "Make toggle responsive (mobile-friendly placement)",
              "tests": [{ "type": "e2e", "description": "Verify toggle works on mobile viewport", "file": "tests/test_i18n.py::test_toggle_responsive" }]
            }
          ]
        },
        {
          "id": "task-10.2",
          "name": "Implement browser language auto-detection",
          "microtasks": [
            {
              "id": "mt-10.2.1",
              "name": "Create detectBrowserLanguage() function using navigator.language",
              "tests": [{ "type": "unit", "description": "Test detection returns 'fr' for fr-CA, fr-FR", "file": "tests/test_i18n.py::test_detect_french" }]
            },
            {
              "id": "mt-10.2.2",
              "name": "Handle language variants (fr-CA, fr-FR ‚Üí fr; en-US, en-GB ‚Üí en)",
              "tests": [{ "type": "unit", "description": "Test variant normalization", "file": "tests/test_i18n.py::test_language_variants" }]
            },
            {
              "id": "mt-10.2.3",
              "name": "Default to English for unsupported languages",
              "tests": [{ "type": "unit", "description": "Test fallback to English", "file": "tests/test_i18n.py::test_unsupported_fallback" }]
            },
            {
              "id": "mt-10.2.4",
              "name": "Apply detected language on page load (before first render)",
              "tests": [{ "type": "e2e", "description": "Verify no English flash for French browsers", "file": "tests/test_i18n.py::test_no_lang_flash" }]
            }
          ]
        },
        {
          "id": "task-10.3",
          "name": "Create translations configuration object",
          "microtasks": [
            {
              "id": "mt-10.3.1",
              "name": "Create translations object with 'en' and 'fr' keys",
              "tests": [{ "type": "unit", "description": "Verify translations object structure", "file": "tests/test_i18n.py::test_translations_structure" }]
            },
            {
              "id": "mt-10.3.2",
              "name": "Add all hero section translations (title, description)",
              "tests": [{ "type": "unit", "description": "Verify hero translations exist", "file": "tests/test_i18n.py::test_hero_translations" }]
            },
            {
              "id": "mt-10.3.3",
              "name": "Add all quick check section translations",
              "tests": [{ "type": "unit", "description": "Verify quick check translations", "file": "tests/test_i18n.py::test_quick_check_translations" }]
            },
            {
              "id": "mt-10.3.4",
              "name": "Add all subscribe form translations (labels, buttons)",
              "tests": [{ "type": "unit", "description": "Verify form translations", "file": "tests/test_i18n.py::test_form_translations" }]
            },
            {
              "id": "mt-10.3.5",
              "name": "Add all alert type translations (snow, waste descriptions)",
              "tests": [{ "type": "unit", "description": "Verify alert type translations", "file": "tests/test_i18n.py::test_alert_translations" }]
            },
            {
              "id": "mt-10.3.6",
              "name": "Add 'How it works' section translations",
              "tests": [{ "type": "unit", "description": "Verify info section translations", "file": "tests/test_i18n.py::test_info_translations" }]
            },
            {
              "id": "mt-10.3.7",
              "name": "Add results section translations (status labels, CTA)",
              "tests": [{ "type": "unit", "description": "Verify results translations", "file": "tests/test_i18n.py::test_results_translations" }]
            },
            {
              "id": "mt-10.3.8",
              "name": "Add all error and success message translations",
              "tests": [{ "type": "unit", "description": "Verify message translations", "file": "tests/test_i18n.py::test_message_translations" }]
            }
          ]
        },
        {
          "id": "task-10.4",
          "name": "Implement language state management",
          "microtasks": [
            {
              "id": "mt-10.4.1",
              "name": "Create currentLanguage variable with localStorage persistence",
              "tests": [{ "type": "e2e", "description": "Verify language saves to localStorage", "file": "tests/test_i18n.py::test_language_persistence" }]
            },
            {
              "id": "mt-10.4.2",
              "name": "Create setLanguage(lang) function to update state and UI",
              "tests": [{ "type": "unit", "description": "Verify setLanguage updates state", "file": "tests/test_i18n.py::test_set_language" }]
            },
            {
              "id": "mt-10.4.3",
              "name": "Create t(key) helper function to get translation",
              "tests": [{ "type": "unit", "description": "Verify t() returns correct translation", "file": "tests/test_i18n.py::test_t_function" }]
            },
            {
              "id": "mt-10.4.4",
              "name": "User selection overrides browser auto-detection",
              "tests": [{ "type": "e2e", "description": "Verify manual selection persists", "file": "tests/test_i18n.py::test_manual_override" }]
            }
          ]
        },
        {
          "id": "task-10.5",
          "name": "Implement applyLanguage() function",
          "microtasks": [
            {
              "id": "mt-10.5.1",
              "name": "Update HTML lang attribute (document.documentElement.lang)",
              "tests": [{ "type": "e2e", "description": "Verify HTML lang changes", "file": "tests/test_i18n.py::test_html_lang_attr" }]
            },
            {
              "id": "mt-10.5.2",
              "name": "Update all static text elements with translations",
              "tests": [{ "type": "e2e", "description": "Verify all text updates on toggle", "file": "tests/test_i18n.py::test_all_text_updates" }]
            },
            {
              "id": "mt-10.5.3",
              "name": "Update placeholder texts for inputs",
              "tests": [{ "type": "e2e", "description": "Verify placeholder translations", "file": "tests/test_i18n.py::test_placeholder_i18n" }]
            },
            {
              "id": "mt-10.5.4",
              "name": "Update ARIA labels for accessibility",
              "tests": [{ "type": "e2e", "description": "Verify ARIA labels translated", "file": "tests/test_i18n.py::test_aria_i18n" }]
            },
            {
              "id": "mt-10.5.5",
              "name": "Update page title (document.title)",
              "tests": [{ "type": "e2e", "description": "Verify page title changes", "file": "tests/test_i18n.py::test_page_title_i18n" }]
            }
          ]
        },
        {
          "id": "task-10.6",
          "name": "Translate dynamic JavaScript messages",
          "microtasks": [
            {
              "id": "mt-10.6.1",
              "name": "Update geolocation messages (Getting location, errors)",
              "tests": [{ "type": "e2e", "description": "Verify geo messages translated", "file": "tests/test_i18n.py::test_geo_messages_i18n" }]
            },
            {
              "id": "mt-10.6.2",
              "name": "Update form validation messages",
              "tests": [{ "type": "e2e", "description": "Verify validation messages translated", "file": "tests/test_i18n.py::test_validation_i18n" }]
            },
            {
              "id": "mt-10.6.3",
              "name": "Update success/error toast messages",
              "tests": [{ "type": "e2e", "description": "Verify toast messages translated", "file": "tests/test_i18n.py::test_toast_i18n" }]
            },
            {
              "id": "mt-10.6.4",
              "name": "Update loading state messages",
              "tests": [{ "type": "e2e", "description": "Verify loading text translated", "file": "tests/test_i18n.py::test_loading_i18n" }]
            }
          ]
        },
        {
          "id": "task-10.7",
          "name": "Add language to subscriber model",
          "microtasks": [
            {
              "id": "mt-10.7.1",
              "name": "Add language column to Subscriber model (default 'en')",
              "tests": [{ "type": "unit", "description": "Verify language field exists", "file": "tests/test_models.py::test_subscriber_language_field" }]
            },
            {
              "id": "mt-10.7.2",
              "name": "Create database migration for language column",
              "tests": [{ "type": "integration", "description": "Verify migration applies", "file": "tests/test_migrations.py::test_language_migration" }]
            },
            {
              "id": "mt-10.7.3",
              "name": "Pass language in subscribe API request",
              "tests": [{ "type": "integration", "description": "Verify API accepts language", "file": "tests/test_routes.py::test_subscribe_language" }]
            },
            {
              "id": "mt-10.7.4",
              "name": "Store subscriber language preference in database",
              "tests": [{ "type": "integration", "description": "Verify language stored", "file": "tests/test_routes.py::test_language_stored" }]
            }
          ]
        },
        {
          "id": "task-10.8",
          "name": "Create French email templates",
          "microtasks": [
            {
              "id": "mt-10.8.1",
              "name": "Create confirmation_fr.html template",
              "tests": [{ "type": "unit", "description": "Verify French confirmation template renders", "file": "tests/test_email.py::test_confirmation_fr" }]
            },
            {
              "id": "mt-10.8.2",
              "name": "Create snow_urgent_fr.html template",
              "tests": [{ "type": "unit", "description": "Verify French urgent template renders", "file": "tests/test_email.py::test_snow_urgent_fr" }]
            },
            {
              "id": "mt-10.8.3",
              "name": "Create snow_scheduled_fr.html template",
              "tests": [{ "type": "unit", "description": "Verify French scheduled template renders", "file": "tests/test_email.py::test_snow_scheduled_fr" }]
            },
            {
              "id": "mt-10.8.4",
              "name": "Create snow_cleared_fr.html template",
              "tests": [{ "type": "unit", "description": "Verify French cleared template renders", "file": "tests/test_email.py::test_snow_cleared_fr" }]
            },
            {
              "id": "mt-10.8.5",
              "name": "Create waste_reminder_fr.html template",
              "tests": [{ "type": "unit", "description": "Verify French waste template renders", "file": "tests/test_email.py::test_waste_reminder_fr" }]
            },
            {
              "id": "mt-10.8.6",
              "name": "Create snow_quebec_fr.html template",
              "tests": [{ "type": "unit", "description": "Verify French Quebec snow template renders", "file": "tests/test_email.py::test_snow_quebec_fr" }]
            },
            {
              "id": "mt-10.8.7",
              "name": "Create waste_reminder_quebec_fr.html template",
              "tests": [{ "type": "unit", "description": "Verify French Quebec waste template renders", "file": "tests/test_email.py::test_waste_quebec_fr" }]
            },
            {
              "id": "mt-10.8.8",
              "name": "Create unsubscribe_fr.html template",
              "tests": [{ "type": "unit", "description": "Verify French unsubscribe template renders", "file": "tests/test_email.py::test_unsubscribe_fr" }]
            }
          ]
        },
        {
          "id": "task-10.9",
          "name": "Update email service to use subscriber language",
          "microtasks": [
            {
              "id": "mt-10.9.1",
              "name": "Add language parameter to send_email function",
              "tests": [{ "type": "unit", "description": "Verify send_email accepts language", "file": "tests/test_email.py::test_send_email_language" }]
            },
            {
              "id": "mt-10.9.2",
              "name": "Select template based on language (template_name_fr.html)",
              "tests": [{ "type": "unit", "description": "Verify correct template selected", "file": "tests/test_email.py::test_template_selection" }]
            },
            {
              "id": "mt-10.9.3",
              "name": "Translate email subjects based on language",
              "tests": [{ "type": "unit", "description": "Verify French email subjects", "file": "tests/test_email.py::test_email_subjects_fr" }]
            },
            {
              "id": "mt-10.9.4",
              "name": "Update all alert sending functions to pass language",
              "tests": [{ "type": "unit", "description": "Verify language passed through", "file": "tests/test_email.py::test_alerts_use_language" }]
            }
          ]
        },
        {
          "id": "task-10.10",
          "name": "Translate unsubscribe page",
          "microtasks": [
            {
              "id": "mt-10.10.1",
              "name": "Add language detection on unsubscribe page",
              "tests": [{ "type": "e2e", "description": "Verify unsubscribe detects language", "file": "tests/test_i18n.py::test_unsubscribe_lang_detect" }]
            },
            {
              "id": "mt-10.10.2",
              "name": "Translate success and error messages",
              "tests": [{ "type": "e2e", "description": "Verify unsubscribe messages translated", "file": "tests/test_i18n.py::test_unsubscribe_messages_fr" }]
            }
          ]
        }
      ]
    },
    {
      "id": "phase-11",
      "name": "City Auto-Detection from Browser Geolocation",
      "tasks": [
        {
          "id": "task-11.1",
          "name": "Implement city detection from coordinates",
          "microtasks": [
            {
              "id": "mt-11.1.1",
              "name": "Create detectCityFromCoordinates(lat, lon) function",
              "tests": [{ "type": "unit", "description": "Verify function returns correct city", "file": "tests/test_geolocation.py::test_detect_city_coords" }]
            },
            {
              "id": "mt-11.1.2",
              "name": "Define Montreal bounding box (45.3-45.8 lat, -74.0 to -73.3 lon)",
              "tests": [{ "type": "unit", "description": "Verify Montreal coords detected", "file": "tests/test_geolocation.py::test_montreal_bounds" }]
            },
            {
              "id": "mt-11.1.3",
              "name": "Define Quebec City bounding box (46.5-47.5 lat, -71.5 to -71.0 lon)",
              "tests": [{ "type": "unit", "description": "Verify Quebec coords detected", "file": "tests/test_geolocation.py::test_quebec_bounds" }]
            },
            {
              "id": "mt-11.1.4",
              "name": "Return null for coordinates outside both cities",
              "tests": [{ "type": "unit", "description": "Verify null for outside coords", "file": "tests/test_geolocation.py::test_outside_bounds" }]
            }
          ]
        },
        {
          "id": "task-11.2",
          "name": "Integrate city detection with Use My Location button",
          "microtasks": [
            {
              "id": "mt-11.2.1",
              "name": "Call detectCityFromCoordinates when geolocation succeeds",
              "tests": [{ "type": "e2e", "description": "Verify city detected on geolocation", "file": "tests/test_geolocation.py::test_geo_city_detect" }]
            },
            {
              "id": "mt-11.2.2",
              "name": "Auto-switch city toggle if detected city differs",
              "tests": [{ "type": "e2e", "description": "Verify toggle switches automatically", "file": "tests/test_geolocation.py::test_auto_switch_city" }]
            },
            {
              "id": "mt-11.2.3",
              "name": "Update localStorage with detected city",
              "tests": [{ "type": "e2e", "description": "Verify city saved after detection", "file": "tests/test_geolocation.py::test_city_saved" }]
            },
            {
              "id": "mt-11.2.4",
              "name": "Apply city theme colors after detection",
              "tests": [{ "type": "e2e", "description": "Verify theme changes on detection", "file": "tests/test_geolocation.py::test_theme_applied" }]
            }
          ]
        },
        {
          "id": "task-11.3",
          "name": "Handle edge cases and errors",
          "microtasks": [
            {
              "id": "mt-11.3.1",
              "name": "Show 'Outside service area' message for unsupported locations",
              "tests": [{ "type": "e2e", "description": "Verify outside area message shown", "file": "tests/test_geolocation.py::test_outside_message" }]
            },
            {
              "id": "mt-11.3.2",
              "name": "Fall back to Montreal if detection fails",
              "tests": [{ "type": "e2e", "description": "Verify Montreal default on failure", "file": "tests/test_geolocation.py::test_fallback_montreal" }]
            },
            {
              "id": "mt-11.3.3",
              "name": "Don't override city if user has manually selected",
              "tests": [{ "type": "e2e", "description": "Verify manual selection preserved", "file": "tests/test_geolocation.py::test_manual_preserved" }]
            },
            {
              "id": "mt-11.3.4",
              "name": "Handle geolocation timeout gracefully",
              "tests": [{ "type": "e2e", "description": "Verify timeout handling", "file": "tests/test_geolocation.py::test_geo_timeout" }]
            }
          ]
        },
        {
          "id": "task-11.4",
          "name": "Add visual feedback for city detection",
          "microtasks": [
            {
              "id": "mt-11.4.1",
              "name": "Show 'Detecting city...' during geolocation",
              "tests": [{ "type": "e2e", "description": "Verify detecting message shown", "file": "tests/test_geolocation.py::test_detecting_message" }]
            },
            {
              "id": "mt-11.4.2",
              "name": "Briefly highlight city toggle when auto-switched",
              "tests": [{ "type": "e2e", "description": "Verify toggle highlight animation", "file": "tests/test_geolocation.py::test_toggle_highlight" }]
            },
            {
              "id": "mt-11.4.3",
              "name": "Show success message confirming detected city",
              "tests": [{ "type": "e2e", "description": "Verify city confirmation message", "file": "tests/test_geolocation.py::test_city_confirmed" }]
            }
          ]
        }
      ]
    },
    {
      "id": "phase-12",
      "name": "i18n Testing & Polish",
      "tasks": [
        {
          "id": "task-12.1",
          "name": "Complete translation review",
          "microtasks": [
            {
              "id": "mt-12.1.1",
              "name": "Review all French translations with native speaker",
              "tests": [{ "type": "manual", "description": "Native speaker sign-off on translations" }]
            },
            {
              "id": "mt-12.1.2",
              "name": "Verify all 96 strings are translated",
              "tests": [{ "type": "unit", "description": "Count translation keys match", "file": "tests/test_i18n.py::test_translation_completeness" }]
            },
            {
              "id": "mt-12.1.3",
              "name": "Check for text overflow in French (longer strings)",
              "tests": [{ "type": "e2e", "description": "Verify no text overflow in FR", "file": "tests/test_i18n.py::test_no_overflow_fr" }]
            }
          ]
        },
        {
          "id": "task-12.2",
          "name": "End-to-end i18n testing",
          "microtasks": [
            {
              "id": "mt-12.2.1",
              "name": "Test full flow in English (check ‚Üí subscribe ‚Üí email)",
              "tests": [{ "type": "e2e", "description": "Full English flow works", "file": "tests/test_i18n.py::test_full_flow_en" }]
            },
            {
              "id": "mt-12.2.2",
              "name": "Test full flow in French (v√©rification ‚Üí abonnement ‚Üí courriel)",
              "tests": [{ "type": "e2e", "description": "Full French flow works", "file": "tests/test_i18n.py::test_full_flow_fr" }]
            },
            {
              "id": "mt-12.2.3",
              "name": "Test language switch mid-session",
              "tests": [{ "type": "e2e", "description": "Mid-session toggle works", "file": "tests/test_i18n.py::test_mid_session_switch" }]
            },
            {
              "id": "mt-12.2.4",
              "name": "Test language + city toggle combination",
              "tests": [{ "type": "e2e", "description": "Both toggles work together", "file": "tests/test_i18n.py::test_lang_city_combo" }]
            }
          ]
        },
        {
          "id": "task-12.3",
          "name": "Accessibility testing for i18n",
          "microtasks": [
            {
              "id": "mt-12.3.1",
              "name": "Verify screen reader announces language changes",
              "tests": [{ "type": "a11y", "description": "Screen reader test", "file": "tests/test_a11y.py::test_lang_screen_reader" }]
            },
            {
              "id": "mt-12.3.2",
              "name": "Verify keyboard navigation of language toggle",
              "tests": [{ "type": "a11y", "description": "Keyboard navigation test", "file": "tests/test_a11y.py::test_lang_keyboard" }]
            },
            {
              "id": "mt-12.3.3",
              "name": "Verify focus management on language switch",
              "tests": [{ "type": "a11y", "description": "Focus management test", "file": "tests/test_a11y.py::test_lang_focus" }]
            }
          ]
        }
      ]
    }
  ],
  "additional_suggestions": [
    {
      "id": "suggestion-1",
      "name": "Auto-detect city from postal code",
      "description": "Instead of requiring user to toggle, detect city automatically when postal code is entered",
      "priority": "high",
      "included": true
    },
    {
      "id": "suggestion-2",
      "name": "Unified unsubscribe token",
      "description": "Single token works for unsubscribing from both cities if user has both",
      "priority": "medium",
      "included": true
    },
    {
      "id": "suggestion-3",
      "name": "City-specific accent colors",
      "description": "Montreal uses blue, Quebec uses purple to visually distinguish cities",
      "priority": "medium",
      "included": true
    },
    {
      "id": "suggestion-4",
      "name": "Shared email domain",
      "description": "Use single Resend account/domain for both cities",
      "priority": "high",
      "included": true
    },
    {
      "id": "suggestion-5",
      "name": "Feature flags per city",
      "description": "ENABLE_MONTREAL and ENABLE_QUEBEC env vars to disable a city if needed",
      "priority": "low",
      "included": true
    },
    {
      "id": "suggestion-6",
      "name": "Bilingual support (FR/EN)",
      "description": "Add language toggle for French/English UI",
      "priority": "high",
      "included": true,
      "reason": "Implementing in Phase 10"
    },
    {
      "id": "suggestion-7",
      "name": "Push notifications",
      "description": "Web push notifications in addition to email",
      "priority": "low",
      "included": false,
      "reason": "Out of scope, requires service worker setup"
    },
    {
      "id": "suggestion-8",
      "name": "Additional cities",
      "description": "Laval, Longueuil, Gatineau support",
      "priority": "low",
      "included": false,
      "reason": "Future enhancement after v2 is stable"
    }
  ],
  "dependencies": {
    "external": [
      {
        "name": "Montreal Planif-Neige API",
        "type": "SOAP/WSDL",
        "url": "https://servicesenligne2.ville.montreal.qc.ca/api/infoneige/"
      },
      {
        "name": "Quebec City ArcGIS API",
        "type": "REST",
        "url": "https://carte.ville.quebec.qc.ca/arcgis/rest/services/CI/Deneigement/MapServer/2/query"
      },
      {
        "name": "ArcGIS World Geocoder",
        "type": "REST",
        "url": "https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"
      },
      {
        "name": "Montreal Geobase Double",
        "type": "CSV",
        "url": "https://donnees.montreal.ca/dataset/geobase-double"
      },
      {
        "name": "Montreal Waste GEOJSON",
        "type": "GEOJSON",
        "url": "https://donnees.montreal.ca/dataset/info-collectes"
      },
      {
        "name": "Resend Email API",
        "type": "REST",
        "url": "https://api.resend.com"
      }
    ],
    "python_packages": [
      "Flask>=3.0.0",
      "Flask-SQLAlchemy>=3.1.0",
      "Flask-Migrate>=4.0.0",
      "Flask-Limiter>=3.5.0",
      "APScheduler>=3.10.0",
      "zeep>=4.2.0",
      "resend>=2.0.0",
      "requests>=2.31.0",
      "shapely>=2.0.0",
      "python-dotenv>=1.0.0",
      "gunicorn>=21.0.0",
      "psycopg2-binary>=2.9.0",
      "pytest>=7.4.0",
      "pytest-flask>=1.3.0",
      "pytest-cov>=4.1.0"
    ]
  }
}
